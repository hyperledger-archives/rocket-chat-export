# SPDX-License-Identifier: Apache-2.0
version: "2.1"

volumes:
 pgdata:
 walletstore:
 grafana-storage:
 prometheus-storage:

services:
 explorerdb.mynetwork.com:
  image: hyperledger/explorer-db:latest
  container_name: explorerdb.mynetwork.com
  hostname: explorerdb.mynetwork.com
  network_mode: host
  environment:
   - DATABASE_DATABASE=fabricexplorer
   - DATABASE_USERNAME=hppoc
   - DATABASE_PASSWORD=password
  volumes:
   - ./app/persistence/fabric/postgreSQL/db/createdb.sh:/docker-entrypoint-initdb.d/createdb.sh
   - pgdata:/var/lib/postgresql/data

 explorer.mynetwork.com:
  image: hyperledger/explorer:latest
  container_name: explorer.mynetwork.com
  hostname: explorer.mynetwork.com
  network_mode: host
  environment:
   - DATABASE_HOST=127.0.0.1
   - DATABASE_USERNAME=hppoc
   - DATABASE_PASSWD=password
   - DISCOVERY_AS_LOCALHOST=true
  volumes:
   - ./examples/net1/config.json:/opt/explorer/app/platform/fabric/config.json
   - ./examples/net1/connection-profile:/opt/explorer/app/platform/fabric/connection-profile
   - ./examples/net1/crypto:/tmp/crypto
   - walletstore:/opt/wallet
  command: sh -c "sleep 16&& node /opt/explorer/main.js && tail -f /dev/null"
  ports:
   - 8090:8080
